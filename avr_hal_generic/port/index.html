<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="API documentation for the Rust `port` mod in crate `avr_hal_generic`."><meta name="keywords" content="rust, rustlang, rust-lang, port"><title>avr_hal_generic::port - Rust</title><link rel="stylesheet" type="text/css" href="../../normalize.css"><link rel="stylesheet" type="text/css" href="../../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" type="text/css" href="../../light.css"  id="themeStyle"><link rel="stylesheet" type="text/css" href="../../dark.css" disabled ><link rel="stylesheet" type="text/css" href="../../ayu.css" disabled ><script id="default-settings"></script><script src="../../storage.js"></script><noscript><link rel="stylesheet" href="../../noscript.css"></noscript><link rel="icon" type="image/svg+xml" href="../../favicon.svg">
<link rel="alternate icon" type="image/png" href="../../favicon-16x16.png">
<link rel="alternate icon" type="image/png" href="../../favicon-32x32.png"><style type="text/css">#crate-search{background-image:url("../../down-arrow.svg");}</style></head><body class="rustdoc mod"><!--[if lte IE 8]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="sidebar"><div class="sidebar-menu">&#9776;</div><a href='../../avr_hal_generic/index.html'><div class='logo-container rust-logo'><img src='../../rust-logo.png' alt='logo'></div></a><p class="location">Module port</p><div class="sidebar-elems"><div class="block items"><ul><li><a href="#modules">Modules</a></li></ul></div><p class="location"><a href="../index.html">avr_hal_generic</a></p><script>window.sidebarCurrent = {name: "port", ty: "mod", relpath: "../"};</script><script defer src="../sidebar-items.js"></script></div></nav><div class="theme-picker"><button id="theme-picker" aria-label="Pick another theme!" aria-haspopup="menu"><img src="../../brush.svg" width="18" alt="Pick another theme!"></button><div id="theme-choices" role="menu"></div></div><script src="../../theme.js"></script><nav class="sub"><form class="search-form"><div class="search-container"><div><select id="crate-search"><option value="All crates">All crates</option></select><input class="search-input" name="search" disabled autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"></div><span class="help-button">?</span>
                <a id="settings-menu" href="../../settings.html"><img src="../../wheel.svg" width="18" alt="Change settings"></a></div></form></nav><section id="main" class="content"><h1 class="fqn"><span class="out-of-band"><span id="render-detail"><a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span><a class="srclink" href="../../src/avr_hal_generic/port.rs.html#1-735" title="goto source code">[src]</a></span><span class="in-band">Module <a href="../index.html">avr_hal_generic</a>::<wbr><a class="mod" href="">port</a></span></h1><div class="docblock"><p>PORTx digital IO Implementations</p>
<h1 id="design-rationale" class="section-header"><a href="#design-rationale">Design Rationale</a></h1>
<p>Each pin has a distinct type which allows pin-dependent HAL functionality to ensure at
compile-time that the correct pins are used.  For example, certain peripherals have the IO
hardwired to some specific pins which can't be changed.  For purposes where the exact pin does
not matter, the distinct types can be 'downgraded' into a generic <code>Pin&lt;MODE&gt;</code> type.  See the
section about <a href="#downgrading">downgrading</a> further down.</p>
<p>To instanciate the pin types, a port is <code>.split()</code> into its pins:</p>

<div class='information'><div class='tooltip ignore'>ⓘ<span class='tooltiptext'>This example is not tested</span></div></div><div class="example-wrap"><pre class="rust rust-example-rendered ignore">
<span class="kw">let</span> <span class="ident">dp</span> <span class="op">=</span> <span class="ident">atmega32u4</span>::<span class="ident">Peripherals</span>::<span class="ident">take</span>().<span class="ident">unwrap</span>();

<span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">portd</span> <span class="op">=</span> <span class="ident">dp</span>.<span class="ident">PORTD</span>.<span class="ident">split</span>();

<span class="kw">let</span> <span class="ident">pd2</span> <span class="op">=</span> <span class="ident">portd</span>.<span class="ident">pd2</span>.<span class="ident">into_output</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">portd</span>.<span class="ident">ddr</span>);</pre></div>
<p>Board crates usually provide a wrapper around that which makes access more convenient:</p>

<div class='information'><div class='tooltip ignore'>ⓘ<span class='tooltiptext'>This example is not tested</span></div></div><div class="example-wrap"><pre class="rust rust-example-rendered ignore">
<span class="kw">let</span> <span class="ident">dp</span> <span class="op">=</span> <span class="ident">arduino_leonardo</span>::<span class="ident">Peripherals</span>::<span class="ident">take</span>().<span class="ident">unwrap</span>();

<span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">pins</span> <span class="op">=</span> <span class="ident">arduino_leonardo</span>::<span class="ident">Pins</span>::<span class="ident">new</span>(
    <span class="ident">dp</span>.<span class="ident">PORTB</span>,
    <span class="ident">dp</span>.<span class="ident">PORTC</span>,
    <span class="ident">dp</span>.<span class="ident">PORTD</span>,
    <span class="ident">dp</span>.<span class="ident">PORTE</span>,
);

<span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">led0</span> <span class="op">=</span> <span class="ident">pins</span>.<span class="ident">led_rx</span>.<span class="ident">into_output</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">pins</span>.<span class="ident">ddr</span>);
<span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">led1</span> <span class="op">=</span> <span class="ident">pins</span>.<span class="ident">led_tx</span>.<span class="ident">into_output</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">pins</span>.<span class="ident">ddr</span>);
<span class="kw">let</span> <span class="kw-2">mut</span> <span class="ident">led2</span> <span class="op">=</span> <span class="ident">pins</span>.<span class="ident">d13</span>.<span class="ident">into_output</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">pins</span>.<span class="ident">ddr</span>);</pre></div>
<h1 id="modes" class="section-header"><a href="#modes">Modes</a></h1>
<p>A pin's mode is modelled via the <code>&lt;MODE&gt;</code> generic parameter.  Only when the pin is in the
correct mode, relevant methods (e.g. <code>set_high()</code>) are available.  Changing the mode is done
via conversion methods that consume the pin:</p>

<div class='information'><div class='tooltip ignore'>ⓘ<span class='tooltiptext'>This example is not tested</span></div></div><div class="example-wrap"><pre class="rust rust-example-rendered ignore">
<span class="comment">// By default, pins are floating inputs</span>
<span class="kw">let</span> <span class="ident">pd2</span>: <span class="ident">PD2</span><span class="op">&lt;</span><span class="ident">mode</span>::<span class="ident">Input</span><span class="op">&lt;</span><span class="ident">mode</span>::<span class="ident">Floating</span><span class="op">&gt;</span><span class="op">&gt;</span> <span class="op">=</span> <span class="ident">portd</span>.<span class="ident">pd2</span>;

<span class="comment">// Convert into pull-up input</span>
<span class="kw">let</span> <span class="ident">pd2</span>: <span class="ident">PD2</span><span class="op">&lt;</span><span class="ident">mode</span>::<span class="ident">Input</span><span class="op">&lt;</span><span class="ident">mode</span>::<span class="ident">PullUp</span><span class="op">&gt;</span><span class="op">&gt;</span> <span class="op">=</span> <span class="ident">pd2</span>.<span class="ident">into_pull_up_input</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">portd</span>.<span class="ident">ddr</span>);

<span class="comment">// Convert into output</span>
<span class="kw">let</span> <span class="ident">pd2</span>: <span class="ident">PD2</span><span class="op">&lt;</span><span class="ident">mode</span>::<span class="ident">Output</span><span class="op">&gt;</span> <span class="op">=</span> <span class="ident">pd2</span>.<span class="ident">into_output</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">portd</span>.<span class="ident">ddr</span>);

<span class="comment">// Convert into tri-state input and output.</span>
<span class="kw">let</span> <span class="ident">pd2</span>: <span class="ident">PD2</span><span class="op">&lt;</span><span class="ident">mode</span>::<span class="ident">TriState</span><span class="op">&gt;</span> <span class="op">=</span> <span class="ident">pd2</span>.<span class="ident">into_tri_state</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">portd</span>.<span class="ident">ddr</span>);</pre></div>
<h3 id="digital-input" class="section-header"><a href="#digital-input">Digital Input</a></h3>
<p>Digital Input pins (i.e. where <code>MODE</code> = <code>mode::Input&lt;_&gt;</code>) have the following methods available:</p>

<div class='information'><div class='tooltip ignore'>ⓘ<span class='tooltiptext'>This example is not tested</span></div></div><div class="example-wrap"><pre class="rust rust-example-rendered ignore">
<span class="comment">// `true` if the pin is high, `false` if it is low</span>
<span class="ident">pd2</span>.<span class="ident">is_high</span>().<span class="ident">void_unwrap</span>();

<span class="comment">// `true if the pin is low, `false` if it is high</span>
<span class="ident">pd2</span>.<span class="ident">is_low</span>().<span class="ident">void_unwrap</span>();</pre></div>
<h3 id="digital-output" class="section-header"><a href="#digital-output">Digital Output</a></h3>
<p>Digital Output pins (i.e. where <code>MODE</code> = <code>mode::Output</code>) can be used like this:</p>

<div class='information'><div class='tooltip ignore'>ⓘ<span class='tooltiptext'>This example is not tested</span></div></div><div class="example-wrap"><pre class="rust rust-example-rendered ignore">
<span class="comment">// Set high or low</span>
<span class="ident">pd2</span>.<span class="ident">set_high</span>().<span class="ident">void_unwrap</span>();
<span class="ident">pd2</span>.<span class="ident">set_low</span>().<span class="ident">void_unwrap</span>();

<span class="comment">// Check what the pin was last set to</span>
<span class="ident">pd2</span>.<span class="ident">is_set_high</span>().<span class="ident">void_unwrap</span>();
<span class="ident">pd2</span>.<span class="ident">is_set_low</span>().<span class="ident">void_unwrap</span>();</pre></div>
<h3 id="digital-tri-state-output-and-input" class="section-header"><a href="#digital-tri-state-output-and-input">Digital Tri-State Output and Input</a></h3>
<p>Digital I/O pins in tri-state mode (i.e. where <code>MODE</code> = <code>mode::TriState</code>),
usually with an external pull-up, are useful for a one wire bus.
They can be used as both output and input pins, like this:</p>

<div class='information'><div class='tooltip ignore'>ⓘ<span class='tooltiptext'>This example is not tested</span></div></div><div class="example-wrap"><pre class="rust rust-example-rendered ignore">
<span class="comment">// Actively drive the pin low.</span>
<span class="ident">pd2</span>.<span class="ident">set_low</span>().<span class="ident">void_unwrap</span>();
<span class="comment">// Release the pin, allowing the external pull-up to pull the pin</span>
<span class="comment">// in the absence of another driver</span>
<span class="ident">pd2</span>.<span class="ident">set_high</span>().<span class="ident">void_unwrap</span>();

<span class="comment">// `true` if the pin is electrically high, `false` if it is low</span>
<span class="ident">pd2</span>.<span class="ident">is_high</span>().<span class="ident">void_unwrap</span>();
<span class="comment">// `true` if the pin is electrically low, driven by either the</span>
<span class="comment">// microcontroller or externally</span>
<span class="ident">pd2</span>.<span class="ident">is_low</span>().<span class="ident">void_unwrap</span>();</pre></div>
<h3 id="other-modes" class="section-header"><a href="#other-modes">Other Modes</a></h3>
<p>Apart from input and output, certain pins can have other functionality associated with them.
E.g. some pins can be used for PWM output, others as ADC inputs.  For those pins, specific
conversion methods exist:</p>

<div class='information'><div class='tooltip ignore'>ⓘ<span class='tooltiptext'>This example is not tested</span></div></div><div class="example-wrap"><pre class="rust rust-example-rendered ignore">
<span class="comment">// Digital IO by default</span>
<span class="kw">let</span> <span class="ident">pd2</span> <span class="op">=</span> <span class="ident">portd</span>.<span class="ident">pd2</span>;

<span class="comment">// Make a pin an ADC channel</span>
<span class="kw">let</span> <span class="ident">pd2_analog</span> <span class="op">=</span> <span class="ident">pd2</span>.<span class="ident">into_analog_input</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">adc</span>);

<span class="comment">// Make a pin a PWM output</span>
<span class="kw">let</span> <span class="ident">pd2_pwm</span> <span class="op">=</span> <span class="ident">pd2</span>.<span class="ident">into_output</span>().<span class="ident">into_pwm</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">timer0</span>);</pre></div>
<h2 id="downgrading" class="section-header"><a href="#downgrading">Downgrading</a></h2>
<p>As described above, usually each pin has its own distinct type.  This is useful in a lot of
cases but can be difficult to deal with when code does not care about the exact pin(s) it is
working with.  An easy example is trying to store a number of pins in an array; this is not
possible when each pin has its own type.</p>
<p>For those usecases, a generic <code>Pin</code> type exists which can represent any pin.  Specific pins are
converted using the <code>.downgrade()</code> method:</p>

<div class='information'><div class='tooltip ignore'>ⓘ<span class='tooltiptext'>This example is not tested</span></div></div><div class="example-wrap"><pre class="rust rust-example-rendered ignore">
<span class="kw">let</span> <span class="ident">pd2</span> <span class="op">=</span> <span class="ident">portd</span>.<span class="ident">pd2</span>.<span class="ident">into_output</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">portd</span>.<span class="ident">ddr</span>);
<span class="kw">let</span> <span class="ident">pd3</span> <span class="op">=</span> <span class="ident">portd</span>.<span class="ident">pd3</span>.<span class="ident">into_output</span>(<span class="kw-2">&amp;</span><span class="kw-2">mut</span> <span class="ident">portd</span>.<span class="ident">ddr</span>);

<span class="kw">let</span> <span class="ident">pins</span>: [<span class="ident">Pin</span><span class="op">&lt;</span><span class="ident">mode</span>::<span class="ident">Output</span><span class="op">&gt;</span>; <span class="number">2</span>] <span class="op">=</span> [<span class="ident">pd2</span>.<span class="ident">downgrade</span>(), <span class="ident">pd3</span>.<span class="ident">downgrade</span>()];</pre></div>
</div><h2 id="modules" class="section-header"><a href="#modules">Modules</a></h2>
<table><tr class="module-item"><td><a class="mod" href="mode/index.html" title="avr_hal_generic::port::mode mod">mode</a></td><td class="docblock-short"><p>IO Modes</p>
</td></tr></table></section><section id="search" class="content hidden"></section><section class="footer"></section><script>window.rootPath = "../../";window.currentCrate = "avr_hal_generic";</script><script src="../../main.js"></script><script defer src="../../search-index.js"></script></body></html>